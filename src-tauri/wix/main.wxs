<?xml version="1.0" encoding="utf-8"?>
<?if $(sys.BUILDARCH)="x86"?>
<?define Win64 = "no" ?>
<?define PlatformProgramFilesFolder = "ProgramFilesFolder" ?>
<?elseif $(sys.BUILDARCH)="x64"?>
<?define Win64 = "yes" ?>
<?define PlatformProgramFilesFolder = "ProgramFiles64Folder" ?>
<?else?>
<?error Unsupported value of sys.BUILDARCH=$(sys.BUILDARCH)?>
<?endif?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
    <Product Id="*" Name="medical-sound" UpgradeCode="e0dfbd15-13eb-5345-91a9-626bbd9f480b" Language="!(loc.TauriLanguage)" Manufacturer="medical-sound" Version="0.2.1">
        <Package Id="*" Keywords="Installer" InstallerVersion="450" Languages="0" Compressed="yes" InstallScope="perMachine" SummaryCodepage="!(loc.TauriCodepage)" />
        <!-- https://docs.microsoft.com/en-us/windows/win32/msi/reinstallmode -->
        <!-- reinstall all files; rewrite all registry entries; reinstall all shortcuts -->
        <Property Id="REINSTALLMODE" Value="amus" />
        <MajorUpgrade AllowDowngrades="yes" Schedule="afterInstallValidate" />
        <InstallExecuteSequence>
            <RemoveShortcuts>Installed AND NOT UPGRADINGPRODUCTCODE</RemoveShortcuts>
        </InstallExecuteSequence>
        <Media Id="1" Cabinet="app.cab" EmbedCab="yes" />
        <Icon Id="ProductIcon" SourceFile="D:\@rust\medical-sound\src-tauri\target\i686-pc-windows-msvc\release\resources\icon.ico" />
        <Property Id="ARPPRODUCTICON" Value="ProductIcon" />
        <Property Id="ARPNOREPAIR" Value="yes" Secure="yes" />
        <!-- Remove repair -->
        <SetProperty Id="ARPNOMODIFY" Value="1" After="InstallValidate" Sequence="execute" />
        <!-- initialize with previous InstallDir -->
        <Property Id="INSTALLDIR">
            <RegistrySearch Id="PrevInstallDirReg" Root="HKCU" Key="Software\medical-sound\medical-sound" Name="InstallDir" Type="raw" />
        </Property>
        <!-- launch app checkbox -->
        <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="!(loc.LaunchApp)" />
        <Property Id="WixShellExecTarget" Value="[!Path]" />
        <CustomAction Id="LaunchApplication" BinaryKey="WixCA" DllEntry="WixShellExec" Impersonate="yes" />
        <UI>
            <!-- ADDED -->
            <Property Id="LicenseCode" />
            <!-- ADDED -->
            <!-- launch app checkbox -->
            <Publish Dialog="ExitDialog" Control="Finish" Event="DoAction" Value="LaunchApplication">WIXUI_EXITDIALOGOPTIONALCHECKBOX = 1 and NOT Installed</Publish>
            <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
            <!-- Skip license dialog -->
            <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseDlg" Order="2">1</Publish>
            <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg" Order="2">1</Publish>
            <!-- ADDED -->
            <Dialog Id="LicenseDlg" Width="370" Height="270" Title="medical-sound Setup">
                <Control Type="Edit" Id="EditLicense" Width="190" Height="15" X="100" Y="120" Property="LicenseCode" Password="yes" />
                <Control Type="PushButton" Id="Next" Width="56" Height="20" X="234" Y="155" Text="Next">
                    <Publish Event="NewDialog" Value="InstallDirDlg">LicenseCode = "Pm0913"</Publish>
                </Control>
                <Control Type="PushButton" Id="Back" Width="56" Height="20" X="100" Y="155" Text="Back">
                    <Publish Event="NewDialog" Value="WelcomeDlg">1</Publish>
                </Control>
                <!-- <Control Type="PushButton" Id="Cancel" Width="56" Height="20" X="234" Y="150" Text="Cancel">
                    <Publish Event="NewDialog" Value="CancelDlg">1</Publish>
                </Control> -->
                <Control Type="Text" Id="Label" Width="190" Height="20" X="100" Y="90" Text="Enter the License Key :" />
            </Dialog>
            <!-- ADDED -->
        </UI>
        <UIRef Id="WixUI_InstallDir" />
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="DesktopFolder" Name="Desktop">
                <Component Id="ApplicationShortcutDesktop" Guid="*">
                    <Shortcut Id="ApplicationDesktopShortcut" Name="medical-sound" Description="Runs medical-sound" Target="[!Path]" WorkingDirectory="INSTALLDIR" />
                    <RemoveFolder Id="DesktopFolder" On="uninstall" />
                    <RegistryValue Root="HKCU" Key="Software\medical-sound\medical-sound" Name="Desktop Shortcut" Type="integer" Value="1" KeyPath="yes" />
                </Component>
            </Directory>
            <Directory Id="$(var.PlatformProgramFilesFolder)" Name="PFiles">
                <Directory Id="INSTALLDIR" Name="medical-sound" />
            </Directory>
            <Directory Id="ProgramMenuFolder">
                <Directory Id="ApplicationProgramsFolder" Name="medical-sound" />
            </Directory>
        </Directory>
        <DirectoryRef Id="INSTALLDIR">
            <Component Id="RegistryEntries" Guid="*">
                <RegistryKey Root="HKCU" Key="Software\medical-sound\medical-sound">
                    <RegistryValue Name="InstallDir" Type="string" Value="[INSTALLDIR]" KeyPath="yes" />
                </RegistryKey>
            </Component>
            <Component Id="Path" Guid="3f4cb81d-bdb4-55a3-80f5-db93242922b7" Win64="$(var.Win64)">
                <File Id="Path" Source="D:\@rust\medical-sound\src-tauri\target\i686-pc-windows-msvc\release\medical-sound.exe" KeyPath="yes" Checksum="yes" />
            </Component>
            <Directory Id="Idcae29defd0844e7b9051e1336cce8fd" Name="_up_">
                <Directory Id="I6c731115bf8e4d68a7b031eaa63216aa" Name="src">
                    <Directory Id="I44cfd86721b244498aee1a594bdeb4e5" Name="assets">
                        <Directory Id="I8c32248b642f4fd3b5208ced859cb59f" Name="images">
                            <Component Id="I754598324fca429c8565eeb8efcbc352" Guid="f6f67ca2-6ca1-45f7-a2b2-10a1b8e7200e" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I754598324fca429c8565eeb8efcbc352" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_1.png" />
                            </Component>
                            <Component Id="Ia75c299167aa48908986d7ace4498a04" Guid="b5c6a4f0-ce3c-4f06-87e7-4fa98d310919" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ia75c299167aa48908986d7ace4498a04" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_2.png" />
                            </Component>
                            <Component Id="I2dc0ea823bd24ff9bc0fe27453ee0c26" Guid="3cf7df72-dbb8-4ecb-bf22-0653b281bc44" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I2dc0ea823bd24ff9bc0fe27453ee0c26" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_3.png" />
                            </Component>
                            <Component Id="Ie57c0b36f7104e078d29838a167f79e5" Guid="0d0ead6a-951b-47de-9d64-b4640e6fdb64" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ie57c0b36f7104e078d29838a167f79e5" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_4.png" />
                            </Component>
                            <Component Id="Ic954daed7d814653ba6251635cce5819" Guid="054e942d-797f-46c6-bdb9-ae55e582afb2" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ic954daed7d814653ba6251635cce5819" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_5.png" />
                            </Component>
                            <Component Id="I0fd5504bb96645698c70c2f74e3de9ca" Guid="43e8e7cb-eea8-4ea1-b33e-d5cfc31adc78" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I0fd5504bb96645698c70c2f74e3de9ca" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_6.png" />
                            </Component>
                            <Component Id="Ib8ce3c80a4ea4eb2825d445118dcdb10" Guid="127cc1f6-92c8-4416-932e-5ecd4ad4f8cc" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ib8ce3c80a4ea4eb2825d445118dcdb10" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_7.png" />
                            </Component>
                            <Component Id="I6795c3a84af24a2194d770d313a7481e" Guid="c5027b5d-0b53-47f7-8c3f-41fe7445eae8" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I6795c3a84af24a2194d770d313a7481e" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_8.png" />
                            </Component>
                            <Component Id="I59cecb13bb04499a8e408e88999fb868" Guid="668f46db-edfe-406f-8a00-231b98843c4c" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I59cecb13bb04499a8e408e88999fb868" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\images\img_9.png" />
                            </Component>
                        </Directory>
                        <Directory Id="I72597f7e0fcd4d45a2abfca55faa88a9" Name="sounds">
                            <Component Id="Iccb5ca78b021448080a6ce4262c97214" Guid="8427db4e-7f0b-4b8c-806e-a72a5e987502" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Iccb5ca78b021448080a6ce4262c97214" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_1.mp3" />
                            </Component>
                            <Component Id="Ie4ec38ac5baa410f838bfc62c6b1d340" Guid="f9db21d4-e021-4b23-9417-bba29fe5074c" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ie4ec38ac5baa410f838bfc62c6b1d340" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_2.mp3" />
                            </Component>
                            <Component Id="Icd324685ccb74eef84685fe452e613cb" Guid="a6ae0330-3431-415e-ab10-cff09dbcd77e" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Icd324685ccb74eef84685fe452e613cb" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_3.mp3" />
                            </Component>
                            <Component Id="I5917c19f70f74d6fb30e312e42312561" Guid="e7ae20ed-5946-43d7-87ad-755a403ccdf9" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I5917c19f70f74d6fb30e312e42312561" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_4.mp3" />
                            </Component>
                            <Component Id="I2a744730f8a2498a9fc2ea5ce32468f6" Guid="453d570a-9590-4b53-9ac2-cdf0a7b379a6" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I2a744730f8a2498a9fc2ea5ce32468f6" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_5.mp3" />
                            </Component>
                            <Component Id="Ia95c7ec61b8542b39849b78ba1c08439" Guid="a9f42422-f3b7-4352-9682-8fdec859448e" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ia95c7ec61b8542b39849b78ba1c08439" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_6.mp3" />
                            </Component>
                            <Component Id="I431cccd8929a4c56a0884af954b05777" Guid="2f195018-4ebe-4f52-a946-d983d6f62af9" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I431cccd8929a4c56a0884af954b05777" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_7.mp3" />
                            </Component>
                            <Component Id="I6267c23343d04effaf9081e3ba13b1ba" Guid="92083fa3-d5fe-43d4-a6eb-615ba3a934b2" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I6267c23343d04effaf9081e3ba13b1ba" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_8.mp3" />
                            </Component>
                            <Component Id="Ic3f3b7be0fcf41edbbdaf40e305cee8d" Guid="71543c42-71cf-405d-9878-3c1d44ae5daa" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ic3f3b7be0fcf41edbbdaf40e305cee8d" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\ko_9.mp3" />
                            </Component>
                            <Component Id="I8a83198eac4c4158b9459ecd0433a5c2" Guid="a6feca85-47fe-4531-91fe-19ea1b970ee7" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I8a83198eac4c4158b9459ecd0433a5c2" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_1.mp3" />
                            </Component>
                            <Component Id="Ib50db24f92264404af68d5c4ccc16b3b" Guid="fc100ab2-7cd9-4abe-8805-d20137046376" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ib50db24f92264404af68d5c4ccc16b3b" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_2.mp3" />
                            </Component>
                            <Component Id="I8baa82f29fb24d6eae8dd4ffb57f08f2" Guid="3402a033-1da6-4750-bfeb-6b0279b2a594" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I8baa82f29fb24d6eae8dd4ffb57f08f2" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_3.mp3" />
                            </Component>
                            <Component Id="I1e274624053648d6b009c1cee3688364" Guid="3482c494-5563-4a88-ad43-734e001cbe69" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I1e274624053648d6b009c1cee3688364" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_4.mp3" />
                            </Component>
                            <Component Id="I203150f9270f4e509bfdbc6ae143aca9" Guid="9bf302c0-7286-49f2-a629-293ff47c4ded" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I203150f9270f4e509bfdbc6ae143aca9" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_5.mp3" />
                            </Component>
                            <Component Id="I17c3ba39d4ed427d9f1f2bf4102c2139" Guid="7f407c9e-2eb2-4b46-9ac8-7cd70b462c2f" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I17c3ba39d4ed427d9f1f2bf4102c2139" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_6.mp3" />
                            </Component>
                            <Component Id="I5c6fc0592da04a6389e32e6d09bd62c4" Guid="b74a092f-dc4b-4091-9913-46e0be376f9c" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_I5c6fc0592da04a6389e32e6d09bd62c4" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_7.mp3" />
                            </Component>
                            <Component Id="Ia3d9775be1374efcbb254c473cb2115d" Guid="e477655e-d3cf-4766-a771-a57984504c39" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ia3d9775be1374efcbb254c473cb2115d" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_8.mp3" />
                            </Component>
                            <Component Id="Ib2744a486d1f48aba328d60bffb47e05" Guid="9343006c-70db-430c-9416-6465272ad9ba" Win64="$(var.Win64)" KeyPath="yes">
                                <File Id="PathFile_Ib2744a486d1f48aba328d60bffb47e05" Source="D:\@rust\medical-sound\src-tauri\..\src\assets\sounds\th_9.mp3" />
                            </Component>
                        </Directory>
                    </Directory>
                </Directory>
            </Directory>
            <Component Id="CMP_UninstallShortcut" Guid="*">
                <Shortcut Id="UninstallShortcut" Name="Uninstall medical-sound" Description="Uninstalls medical-sound" Target="[System64Folder]msiexec.exe" Arguments="/x [ProductCode]" />
                <RemoveFolder Id="INSTALLDIR" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\medical-sound\medical-sound" Name="Uninstaller Shortcut" Type="integer" Value="1" KeyPath="yes" />
            </Component>
        </DirectoryRef>
        <DirectoryRef Id="ApplicationProgramsFolder">
            <Component Id="ApplicationShortcut" Guid="*">
                <Shortcut Id="ApplicationStartMenuShortcut" Name="medical-sound" Description="Runs medical-sound" Target="[!Path]" Icon="ProductIcon" WorkingDirectory="INSTALLDIR">
                    <ShortcutProperty Key="System.AppUserModel.ID" Value="medical-sound" />
                </Shortcut>
                <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall" />
                <RegistryValue Root="HKCU" Key="Software\medical-sound\medical-sound" Name="Start Menu Shortcut" Type="integer" Value="1" KeyPath="yes" />
            </Component>
        </DirectoryRef>
        <Feature Id="MainProgram" Title="Application" Description="!(loc.InstallAppFeature)" Level="1" ConfigurableDirectory="INSTALLDIR" AllowAdvertise="no" Display="expand" Absent="disallow">
            <ComponentRef Id="RegistryEntries" />
            <ComponentRef Id="I754598324fca429c8565eeb8efcbc352" />
            <ComponentRef Id="Ia75c299167aa48908986d7ace4498a04" />
            <ComponentRef Id="I2dc0ea823bd24ff9bc0fe27453ee0c26" />
            <ComponentRef Id="Ie57c0b36f7104e078d29838a167f79e5" />
            <ComponentRef Id="Ic954daed7d814653ba6251635cce5819" />
            <ComponentRef Id="I0fd5504bb96645698c70c2f74e3de9ca" />
            <ComponentRef Id="Ib8ce3c80a4ea4eb2825d445118dcdb10" />
            <ComponentRef Id="I6795c3a84af24a2194d770d313a7481e" />
            <ComponentRef Id="I59cecb13bb04499a8e408e88999fb868" />
            <ComponentRef Id="Iccb5ca78b021448080a6ce4262c97214" />
            <ComponentRef Id="Ie4ec38ac5baa410f838bfc62c6b1d340" />
            <ComponentRef Id="Icd324685ccb74eef84685fe452e613cb" />
            <ComponentRef Id="I5917c19f70f74d6fb30e312e42312561" />
            <ComponentRef Id="I2a744730f8a2498a9fc2ea5ce32468f6" />
            <ComponentRef Id="Ia95c7ec61b8542b39849b78ba1c08439" />
            <ComponentRef Id="I431cccd8929a4c56a0884af954b05777" />
            <ComponentRef Id="I6267c23343d04effaf9081e3ba13b1ba" />
            <ComponentRef Id="Ic3f3b7be0fcf41edbbdaf40e305cee8d" />
            <ComponentRef Id="I8a83198eac4c4158b9459ecd0433a5c2" />
            <ComponentRef Id="Ib50db24f92264404af68d5c4ccc16b3b" />
            <ComponentRef Id="I8baa82f29fb24d6eae8dd4ffb57f08f2" />
            <ComponentRef Id="I1e274624053648d6b009c1cee3688364" />
            <ComponentRef Id="I203150f9270f4e509bfdbc6ae143aca9" />
            <ComponentRef Id="I17c3ba39d4ed427d9f1f2bf4102c2139" />
            <ComponentRef Id="I5c6fc0592da04a6389e32e6d09bd62c4" />
            <ComponentRef Id="Ia3d9775be1374efcbb254c473cb2115d" />
            <ComponentRef Id="Ib2744a486d1f48aba328d60bffb47e05" />
            <Feature Id="ShortcutsFeature" Title="Shortcuts" Level="1">
                <ComponentRef Id="Path" />
                <ComponentRef Id="CMP_UninstallShortcut" />
                <ComponentRef Id="ApplicationShortcut" />
                <ComponentRef Id="ApplicationShortcutDesktop" />
            </Feature>
            <Feature Id="Environment" Title="PATH Environment Variable" Description="!(loc.PathEnvVarFeature)" Level="1" Absent="allow">
                <ComponentRef Id="Path" />
            </Feature>
        </Feature>
        <Feature Id="External" AllowAdvertise="no" Absent="disallow"></Feature>
        <!-- WebView2 -->
        <Property Id="WVRTINSTALLED">
            <RegistrySearch Id="WVRTInstalledSystem" Root="HKLM" Key="SOFTWARE\Microsoft\EdgeUpdate\Clients\{F3017226-FE2A-4295-8BDF-00C3A9A7E4C5}" Name="pv" Type="raw" Win64="no" />
            <RegistrySearch Id="WVRTInstalledUser" Root="HKCU" Key="SOFTWARE\Microsoft\EdgeUpdate\Clients\{F3017226-FE2A-4295-8BDF-00C3A9A7E4C5}" Name="pv" Type="raw" />
        </Property>
        <CustomAction Id="DownloadAndInvokeBootstrapper" Directory="INSTALLDIR" Execute="deferred" ExeCommand="powershell.exe -NoProfile -windowstyle hidden Invoke-WebRequest -Uri &quot;https://go.microsoft.com/fwlink/p/?LinkId=2124703&quot; -OutFile &quot;$env:TEMP\MicrosoftEdgeWebview2Setup.exe&quot; ; &amp; $env:TEMP\MicrosoftEdgeWebview2Setup.exe /install" Return="check" />
        <InstallExecuteSequence>
            <Custom Action="DownloadAndInvokeBootstrapper" Before="InstallFinalize"><![CDATA[NOT(REMOVE OR WVRTINSTALLED)]]></Custom>
        </InstallExecuteSequence>
        <SetProperty Id="ARPINSTALLLOCATION" Value="[INSTALLDIR]" After="CostFinalize" />
    </Product>
</Wix>
